<style>
    textarea {
        resize: none;
    }
    textarea:focus {
        outline: none;
    }

    #input {
        min-height: 74px;
    }

    #out {
        margin-bottom: 4px;
    }

    #out {
        font-family: monospace;
        width: 100%;
        overflow: hidden;
        resize: none;
        border: 1px solid #ccc;
        padding: 5px;
        white-space: pre-wrap;   /* preserve spaces and line breaks */
        word-wrap: break-word;   /* legacy, widely supported */
        overflow-wrap: anywhere; /* modern way to break anywhere */
    }

    .back-to-main {
        position: fixed;
        top: 10px;
        right: 10px;
    }
</style>

<head>
    <meta charset="UTF-8">
    <meta property="og:title" content="ngimëte IPA Converter">
    <meta property="og:description" content="Romanization to script and IPA conversion for the ngimëte language.">
    <meta property="og:url" content="https://rus1130.github.io/projects/ngimete/ipa">
</head>

<body>
    <div class="back-to-main">
        <button onclick="location.href='index.html'" style="padding: 4px;">Back to main page</button>
    </div>
    Type a dash (-) to automatically put it the correct connecting letter.<br><br>
    <textarea id="input" style="width: 100%; height: 80px; font-family: monospace;" placeholder="write text here" spellcheck="false"></textarea>

    <textarea id="out" style="font-family: monospace; margin-top: 10px;" readonly placeholder="output" spellcheck="false"></textarea>

    <button id="all" style="padding: 10px;">copy all</button>
    <button id="script-ortho" style="padding: 10px;">copy script + ortho</button>
    <button id="ortho-ipa" style="padding: 10px;">copy ortho + IPA</button>
    <button id="script-ipa" style="padding: 10px;">copy script + IPA</button>
    <br><br>
    <button id="ortho" style="padding: 10px;">copy ortho</button>
    <button id="ipa" style="padding: 10px;">copy IPA</button>
    <button id="script" style="padding: 10px;">copy script</button>
    <label for="alternate-mode">
        <input type="checkbox" id="alternate-mode" checked>
        Alternate lines
    </label>
    <label for="script-type">
        <input type="checkbox" id="script-type" checked>
        Use merged script
    </label>
</body>
<script type="module">
import { Writer, ConlangContent } from './lib.js';
import { dict } from './dictionary.js';

await new Promise(r => setTimeout(r, 150));

const input = document.getElementById("input");
const output = document.getElementById("out");

// const allButton = document.getElementById("all");
// const orthoButton = document.getElementById("ortho");
// const ipaButton = document.getElementById("ipa");
// const orthoIPAButton = document.getElementById("ortho-ipa");
// const scriptButton = document.getElementById("script");
const alternateModeCheckbox = document.getElementById("alternate-mode");
const scriptTypeCheckbox = document.getElementById("script-type");

const allButton = document.getElementById("all");
const orthoButton = document.getElementById("ortho");
const ipaButton = document.getElementById("ipa");
const scriptButton = document.getElementById("script");
const orthoIPAButton = document.getElementById("ortho-ipa");
const scriptOrthoButton = document.getElementById("script-ortho");
const scriptIPAButton = document.getElementById("script-ipa");


const random = dict.randomWord(["Connecting Letters", "Vowel Sounds", "Consonant Sounds", "Grammar"], true)



input.textContent = random.value["Standard"]
input.textContent = "ngawu mbawë ngingi túwus á'á tsi'i nggala gyelu kyesi ndawi mbaba ngguso tsa'an ábao pifwe tuha welebing fetsimwa fesúa witsunggá'o fwí kewes fwígiwes tembbe us simbbärnta a'atsilwi ipalas esiya benise witsumbbenise'o imaso emeso fesúaso"
console.log(random.key);
//input.textContent = "babe ngawu mbawë ngingi túwus á'á tsi'i nggala gyelu kyesi ndawi mbaba ngguso tsa'an ábao pifwe tuha welebing fetsimwa fesúa witsunggá'o fwí kewes fwígiwes tembbe"
updateOutput();

function setOutputText(text) {
    output.value = text;

    output.style.height = "auto";

    output.style.height = output.scrollHeight + "px";
}

function setInputHeight(){
    input.style.height = "auto";
    input.style.height = Math.max(input.scrollHeight, 74)  + "px";
}

function updateOutput() {
    const value = input.value;
    if (!value) {
        setOutputText("");
        return;
    }

    const cc = new ConlangContent(value);
    
    setOutputText(cc.toString(scriptTypeCheckbox.checked ? 1 : 0, alternateModeCheckbox.checked, ["ortho", "script", "ipa"]));
}

input.addEventListener("input", setInputHeight);
input.addEventListener("input", updateOutput);

alternateModeCheckbox.addEventListener("change", updateOutput);
scriptTypeCheckbox.addEventListener("change", updateOutput);

function handleButton(button, categories){
    const ogText = button.innerText;
    button.addEventListener("click", () => {
        const value = input.value;
        if (!value) return;

        const cc = new ConlangContent(value);
        navigator.clipboard.writeText(cc.toString(1, alternateModeCheckbox.checked, categories));
        button.innerText = "copied!";
        setTimeout(() => button.innerText = ogText, 2000);
    });
}

handleButton(allButton, ["ortho", "script", "ipa"]);
handleButton(scriptOrthoButton, ["ortho", "script"]);
handleButton(orthoIPAButton, ["ortho", "ipa"]);
handleButton(scriptIPAButton, ["script", "ipa"]);
handleButton(orthoButton, ["ortho"]);
handleButton(ipaButton, ["ipa"]);
handleButton(scriptButton, ["script"]);
</script>
