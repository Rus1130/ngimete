<style>
    table {
        border-collapse: collapse;
        margin: 20px 0;
    }

    th, td {
        border: 1px solid #ccc;
        padding: 4px 8px;
        text-align: center;
        font-size: 14px;
    }

    tbody > tr > th, table > thead > tr > th {
        background-color: #DDD;
        border: 1px solid #999;
    }

    .cell:hover {
        background-color: #F0F0F0;
    }

    .cell, td {
        user-select: none;
    }

    td {
        cursor: pointer;
    }

    th {
        cursor: default;
        user-select: none;
    }

    .cell-hover-path {
        background-color: #E0E0E0;
    }

    .back-to-main {
        position: fixed;
        top: 10px;
        right: 10px;
    }

    button:focus, input:focus, select:focus, textarea:focus, [contenteditable]:focus {
        outline:none;
    }

    select, option {
        cursor: pointer;
    }
    
</style>
<head>
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:url" content="">
    <meta name="google" content="notranslate">
</head>
<body>
    <div class="back-to-main">
        <button onclick="location.href='index.html'" style="padding: 4px;">Back to main page</button>
    </div>
    <div>
        Dialect: 
        <select id="dialect-select">
            <option value="Standard" selected>Standard</option>
            <option value="A'atsilwi">A'atsilwi</option>
        </select><br>
        Sort: 
        <select id="sort-select">
            <option value="comparison" selected>Comparison</option>
            <option value="alphabet">Alphabetical</option>
        </select><br>
        character begins word:
        <input type="checkbox" id="onset-checkbox">
    </div>
        Click a cell to copy its content to clipboard.
</body>
<script type="module">

    import { ConlangContent } from './lib.js';

    ConlangContent.toStringInfo = false;

    const dialectSelect = document.getElementById("dialect-select");

    dialectSelect.addEventListener("change", () => {
        // Regenerate table with new dialect
        document.body.removeChild(document.getElementById("combination-table"));
        const combinations = generate2DCombinations();
        createTable(combinations);
    });

    function isOnset() {
        return document.getElementById("onset-checkbox").checked;
    }

    const onsetCheckbox = document.getElementById("onset-checkbox");

    onsetCheckbox.addEventListener("change", () => {
        // Remove old table
        const oldTable = document.getElementById("combination-table");
        if (oldTable) oldTable.remove();

        // Regenerate combinations and table
        const combinations = generate2DCombinations();
        createTable(combinations);
    });
    
    const consonants_alphabet_sort =   ["Ø", "'", "b", "d",  "f", "g", "gy", "h", "k", "ky",  "l", "m", "mb", "n", "nd", "ng", "ngg", "p",  "s", "t", "ts", "v",  "w", "y"];
    const consonants_comparison_sort = ["Ø", "p", "b", "mb", "t", "d", "nd", "k", "g", "ngg", "f", "v", "s",  "ts", "'", "h",  "ky",  "gy", "m", "n", "ng", "w", "y", "l"];

    const vowels_alphabet_sort = ["Ø","a","á","ä","är","e","é","ë","i","í","o","ó","u","ú","ü"];
    const vowels_comparison_sort = ["Ø","a","á","ä","är","e","é","ë","i","í","o","ó","u","ú","ü"];

    // ["Ø", "i","ü","í","u","ú","e","é","ë","o","ó","a","á","ä","är"];

    function clearCellHovers(){
        const old = document.querySelectorAll(".cell-hover-path");
        old.forEach(el => el.classList.remove("cell-hover-path"));
    }

    function dialectContent(cc, singleType) {
        let str = dialectSelect.value == "Standard" ? cc.toString("high", undefined, [singleType]) : cc.toString("low", undefined, [singleType])
        if(!isOnset() && str != null && dialectSelect.value == "Standard") {
            str = str.replaceAll("ᨌ", "");
        }
        return str;
    }

    let currentSort = "comparison";

    const sortSelect = document.getElementById("sort-select");

    sortSelect.addEventListener("change", () => {
        currentSort = sortSelect.value;

        // Remove old table
        const oldTable = document.getElementById("combination-table");
        if (oldTable) oldTable.remove();

        // Regenerate combinations and table
        const combinations = generate2DCombinations();
        createTable(combinations);
    });


    function getConsonants() {
        if(currentSort == "alphabet") {
            return consonants_alphabet_sort;
        } else if (currentSort == "comparison") {
            return consonants_comparison_sort;
        }
    }

    function getVowels() {
        if(currentSort == "alphabet") {
            return vowels_alphabet_sort;
        } else if (currentSort == "comparison") {
            return vowels_comparison_sort;
        }
    }


    function generate2DCombinations() {
        const results = [];

        for (const onset of getConsonants()) {
            const row = [];
            for (const vowel of getVowels()) {
                let cc = new ConlangContent((onset + vowel).replaceAll("Ø", ""));

                let script = dialectContent(cc, "script");

                row.push(cc);
            }
            results.push(row);
        }

        return results;
    }

    function createTable(matrix) {
        const table = document.createElement("table");
        table.id = "combination-table";

        table.addEventListener("mouseleave", (e) => {
            clearCellHovers();
        });

        // header row (vowels)
        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");

        // empty top-left corner
        const empty = document.createElement("th");
        headerRow.appendChild(empty);

        const consonants = getConsonants();
        const vowels = getVowels();

        for (const v of vowels) {
            const th = document.createElement("th");
            th.textContent = "-"+v;

            th.addEventListener("mouseenter", (e) => {
                clearCellHovers();

                // Highlight entire column
                for (let rowIdx = 0; rowIdx < consonants.length; rowIdx++) {
                    document.getElementById(`cell-${rowIdx}-${vowels.indexOf(v)}`).classList.add("cell-hover-path");
                }
            });

            headerRow.appendChild(th);
        }

        thead.appendChild(headerRow);
        table.appendChild(thead);

        // body rows
        const tbody = document.createElement("tbody");

        for (let i = 0; i < consonants.length; i++) {
            const row = document.createElement("tr");

            // consonant label
            const th = document.createElement("th");
            th.textContent = consonants[i] + "-";

            th.addEventListener("mouseenter", (e) => {
                clearCellHovers();

                // Highlight entire row
                for (let col = 0; col < vowels.length; col++) {
                    document.getElementById(`cell-${i}-${col}`).classList.add("cell-hover-path");
                }
            });

            row.appendChild(th);

            for (let j = 0; j < matrix[i].length; j++) {
                const cellValue = matrix[i][j];
                const td = document.createElement("td");
                td.textContent = dialectContent(cellValue, "script");
                td.title = dialectContent(cellValue, "ortho")

                // Unique ID using i and j
                td.id = `cell-${i}-${j}`;
                td.className = "cell";

                // Hover event
                td.addEventListener("mouseenter", (e) => {
                    clearCellHovers();

                    // Row and column indices
                    const x = i;
                    const y = j;

                    // Highlight row
                    for (let col = 0; col <= j; col++) {
                        document.getElementById(`cell-${i}-${col}`).classList.add("cell-hover-path");
                    }

                    // Highlight column up to hovered cell
                    for (let rowIdx = 0; rowIdx <= i; rowIdx++) {
                        document.getElementById(`cell-${rowIdx}-${j}`).classList.add("cell-hover-path");
                    }
                });

                td.addEventListener("click", (e) => {
                    navigator.clipboard.writeText(dialectContent(cellValue, "script"));
                });

                row.appendChild(td);
            }

            tbody.appendChild(row);
        }

        table.appendChild(tbody);
        document.body.appendChild(table);
    }

    const combinations = generate2DCombinations();

    createTable(combinations);
</script>